[skill]
name = "skill-cache"
version = "0.1.0"
description = "Local skill cache for the Knarr DHT: harvest all skills into SQLite, search by name/tag/schema, mock execution for fast chain iteration."
tags = ["infra", "cache", "forge", "discovery"]
handler = "skill_cache_query_lite.py:handle"

[skill.schema]
input = {q = "string", name = "string", tag = "string", has_input = "string", has_output = "string"}
output = {status = "string", count = "string", skills_json = "string"}

[skill.pricing]
price = 0.5

# Extra handlers — each becomes a separate [skills.*] entry on install.
# Fields override the main skill defaults. Missing fields are inherited.

[skill.extra_handlers.skill-cache-init-lite]
handler = "skill_cache_init_lite.py:handle"
description = "Create/migrate local skill cache SQLite DB. Idempotent. Actions: init, reset, status."
tags = ["infra", "cache", "forge"]
visibility = "private"
price = 0.1
input_schema = {action = "string"}
output_schema = {status = "string", db_path = "string", schema_version = "string", action_taken = "string"}

[skill.extra_handlers.skill-cache-harvest-lite]
handler = "skill_cache_harvest_lite.py:handle"
description = "Walk DHT network, upsert all discovered skills into local cache, mark absent skills stale."
tags = ["infra", "cache", "harvest", "dht", "forge"]
visibility = "private"
price = 0.1
input_schema = {purge_stale_after = "string"}
output_schema = {status = "string", harvest_id = "string", total_found = "string", unique_skills = "string", upserted = "string", duration_ms = "string"}

[skill.extra_handlers.skill-cache-mock-lite]
handler = "skill_cache_mock_lite.py:handle"
description = "Mock-execute a cached skill: replay recorded output, generate synthetic from schema, or passthrough to live."
tags = ["infra", "cache", "mock", "testing", "forge"]
visibility = "private"
price = 0.1
input_schema = {skill = "string", input_json = "string", mode = "string"}
output_schema = {status = "string", mock_mode = "string", output_json = "string", confidence = "string"}

[skill.extra_handlers.skill-cache-stats-lite]
handler = "skill_cache_stats_lite.py:handle"
description = "Skill cache health: total/fresh/stale counts, demo coverage, harvest history, DB size."
tags = ["infra", "cache", "monitoring", "forge"]
visibility = "private"
price = 0.1
input_schema = {action = "string"}
output_schema = {status = "string", unique_skills = "string", coverage_pct = "string", last_harvest_at = "string"}

[skill.dependencies]
# No external dependencies — stdlib only (sqlite3, json, time, os)
